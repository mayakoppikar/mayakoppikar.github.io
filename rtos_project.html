<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RTOS for Formula 1 Robot - Maya Koppikar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">

<div class="container py-5">
  <!-- Top Section: All text on left, images on right -->
  <div class="row mb-5">
    <!-- Text Column -->
    <div class="col-md-8">
      <h2>RTOS for Formula 1 Robot</h2>
      <p>This project focuses on building a real-time operating system (RTOS) for a Formula 1 robot. I worked on the OS Kernel and memory management and then joined a team of 5 to develop a race strategy to compete against 10-15 teams. This project was part of a graduate ECE Class at UT Austin called Embedded Real-Time Systems and took us 4 months (January 2025 - April 2025) to complete. </p>
<br>
      <h6>Key Features</h6>
      <ul>
        <li>Task scheduling with priority-based preemption</li>
        <li>Motor control via PWM</li>
        <li>Sensor fusion from LIDARs</li>
        <li>Interfacing via CAN bus</li>
      </ul>

      <h6>Tech Stack</h6>
      <ul>
        <li><b>Programming:</b> C, ARM Assembly</li>
        <li><b>Hardware:</b> TM4C Microcontroller</li>
        <li><b>Environment:</b> ARM Keil uVision </li>
        <li><b>RTOS Concepts:</b> Scheduling, Semaphores, Queues</li>
      </ul>

     <br><br>

<h6>Design Process</h6>
<ol>
  <li>
    <strong>OS Kernel:</strong> 
    Our code implements 6 linked lists representing tasks of priorities 0-6, with priority 0 being the most critical. The context switch code handles cases when all tasks  within each linked list are sleeping and has an idle-safe thread to avoid null-pointer hard-faults. We learnt the importance of using minimally intrusive debugging techniques (mainly logic analyzers) by measuring system performance with and without debugging tools.
    
    <!-- Images stacked vertically -->
    <img src="images/kernel_logicanalyzer.png" alt="Log analyzer" class="img-fluid my-3" style="max-width:300px;">
    <img src="images/context_switch.png" alt="Context switching" class="img-fluid my-3" style="max-width:300px;">
    <img src="images/debug.png" alt="Debug Data" class="img-fluid my-3" style="max-width:400px;">
  </li>
<br>
  <li>
    <strong>Memory Management:</strong>
    We implemented a File Allocation Table (FAT) file system abstraction to manage memory. In order to implement processes in our RTOS, we worked on a SPI driver for an SD card. Doing so, I learned about the SPI protocol. Later we wrote code to implement the FAT, which involves creating a directory to store file metadata (file names, sizes, starting locations) and 512-byte sectors where data is stored.

    <!-- Images -->
    <img src="images/spi_packets.png" alt="SPI Packet" class="img-fluid my-3" style="max-width:450px;">
  </li>
<br>
  <li>
    <strong>Sensor Data Acquisition:</strong>
    We read 3 distance values per sample: one in the center pointing straight, and two positioned 45 degrees on the left/right of center, giving us 3 points to generate coefficients for a corresponding parabola. We find the parabola's vertex and use inverse trig to find the vertex angle. The magnitude of this angle is used in the motor control algorithm. We use TFLuna LIDARs, as they provide smooth digital readings via UART.

    <!-- Images -->
    <img src="images/sensors.png" alt="Sensors" class="img-fluid my-3" style="max-width:300px;">
    <img src="images/tfluna.png" alt="TF Luna LIDAR" class="img-fluid my-3" style="max-width:300px;">
  </li>
<br>
  <li>
    <strong>Motor Control and Race Strategy:</strong>
    We began with a call-graph to formulate a high-level strategy. The motors are controlled using differential steering. We apply a base power to both motors and use the input angle from LIDAR to calculate an offset value. When turning right, we add the offset to the left wheel and subtract from the right (and vice versa). The offset is tuned using a PD control algorithm before being applied as the PWM duty cycle.

    <!-- Images -->
    <img src="images/call_graph.png" alt="Call Graph" class="img-fluid my-3" style="max-width:300px;">
    <img src="images/algo.png" alt="Algorithm" class="img-fluid my-3" style="max-width:500px;">
  </li>
<br>
  <li>
    <strong>Testing & Tuning:</strong>
    Once the kernel, sensors, and motors were fully initialized, we tuned the PD control. Our team set up multiple race tracks, measured the robot's response to sharp turns, and adjusted the Kp and Kd values of our control algorithm accordingly.
  </li>
  <br>
</ol>






      <h6>Major Challenges & Key Takeaways</h6>
      <ul>
        <li><b>OS Kernel Bugs:</b> Our kernel has overcome many bugs. Some of the most notable (and hardest to debug) were leaving OS Sleep and Kill functions within interrupts, branching to null address pointers when all tasks are sleeping, and conetxt switching within an interrupt instead of after exiting the interrupt handler. </li>
        <br>
        <li><b>Motor PWM:</b> Towards the end, after we implemented differential steering, we often ran into cases where the MCU would reset and the code would enter the Hard Fault Handler. The reason for this is that when we set our motor PWM duty cycle above 80-90%, this would draw too much current and cause the MCU to reset. We fixed this by capping our duty cycle to 80%.  </li>
        <br>
        <li><b>Key Takeaways + Skils:</b>
          <ul>
            <li>Using logic analyzers and other minimally intrusive debug techniques</li>
            <li>Reading the disassembly window + understanding compiler optimizations </li>
            <li>Reading sensor datasheets to write drivers!</li>
          </ul>
        </li>
      </ul>
    </div>
<br>
    <!-- Images Column -->
    <div class="col-md-4">
      <img src="images/teampic.JPG" alt="Team Picture" class="img-fluid mb-3">
      <img src="images/robotCloseup.JPG" alt="Robot close-up" class="img-fluid mb-3">
    </div>
  </div>

  <!-- Demos Section -->
  <section id="currentprojects" class="container py-5">
    <h2>Demos</h2>
    <div class="row">

      <!-- Demo 1 -->
      <div class="col-md-4 mb-4">
        <h4>The Initial Run</h4>
        <div class="ratio ratio-16x9 mb-3">
          <iframe src="https://drive.google.com/file/d/1keadQgqoKQPhF_bU6Q8gEzgoIbei8LyO/preview" 
                  title="RTOS Initial Run" 
                  allowfullscreen></iframe>
        </div>
        <p>April 12,2025: This is our robot's first run... At this stage it collided into many walls, which we learnt was mainly because we had not (yet) tuned our PID controller. </p>
      </div>

      <!-- Demo 2 -->
      <div class="col-md-4 mb-4">
        <h4>A Few Iterations In</h4>
        <div class="ratio ratio-16x9 mb-3">
          <iframe src="https://drive.google.com/file/d/1qx9NNnm9EuUA9mBNKkrcVfnb6nZNtwH9/preview" 
                  title="Couple Days Later" 
                  allowfullscreen></iframe>
        </div>
        <p>April 15, 2025: At this stage, our robot is moving much faster... By now, we have added differential steering allowing for much faster, tighter turns. Also, adding a back-up subroutine was a game-changer, allowing for even higher motor speeds.</p>
      </div>

      <!-- Demo 3 -->
      <div class="col-md-4 mb-4">
        <h4>Race Day</h4>
        <div class="ratio ratio-16x9 mb-3">
          <iframe src="https://drive.google.com/file/d/1usMtY5nBHVOBffB84Q1iw04r2i5gzHkq/preview" 
                  title="Race Day" 
                  allowfullscreen></iframe>
        </div>
        <p>April 24, 2025: This is our robot on race day... We placed 3rd overall, check out this epic pass! üèéÔ∏èüèéÔ∏èüèéÔ∏è</p>
      </div>

    </div>
  </section>
<a href="index.html" class="btn btn-secondary mb-5">‚Üê Back to Portfolio</a>
</div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
